// Generated by CoffeeScript 1.10.0
'use strict';
angular.module('subzapp_mobile').controller('RegisterController', [
  '$scope', '$state', '$http', '$window', 'message', 'RESOURCES', '$ionicLoading', '$rootScope', function($scope, $state, $http, $window, message, RESOURCES, $ionicLoading, $rootScope) {
    console.log("Register Controller");
    $rootScope.USER = null;
    return $scope.register_submit = function() {
      $ionicLoading.show({
        template: 'Registering...'
      });
      console.log($scope.register_form_data);
      return $http({
        method: 'POST',
        url: RESOURCES.DOMAIN + "/auth/signup",
        data: $scope.register_form_data
      }).then((function(response) {
        console.log("Registration successfull " + (JSON.stringify(response)));
        window.localStorage.setItem('user_token', response.data.data.token);
        window.localStorage.setItem('user_id', response.data.data.user.id);
        $ionicLoading.hide();
        return $state.go('all_org');
      }), function(errResponse) {
        console.log("Registration failed " + (JSON.stringify(errResponse.data.invalidAttributes.email[0].message)));
        $ionicLoading.hide();
        window.USER = null;
        message.error(errResponse.data.invalidAttributes.email[0].message);
        return $state.go('login');
      });
    };
  }
]);
